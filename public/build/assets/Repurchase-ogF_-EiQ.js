import{b as F,r as o,j as e,H as L,a as T}from"./app-CK5W6Rwp.js";import{A as _}from"./AuthenticatedLayout-fwSN-iAm.js";const i=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(Number(t||0));function A({open:t,title:d,message:r,tone:c="neutral",onClose:m}){if(!t)return null;const a=c==="success"?"ring-emerald-400":c==="error"?"ring-rose-400":"ring-cyan-400";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:`w-full max-w-md rounded-2xl bg-white shadow-xl ring ${a} ring-1`,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:d}),e.jsx("button",{onClick:m,className:"rounded-md p-1 text-slate-500 hover:bg-slate-100",children:"✕"})]}),e.jsx("div",{className:"p-4 text-slate-700 whitespace-pre-line",children:r}),e.jsx("div",{className:"flex justify-end border-t border-slate-200 p-3",children:e.jsx("button",{onClick:m,className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700",children:"Close"})})]})})}function B({it:t,onInc:d,onDec:r,onRemove:c}){const m=Number(t.price)*Number(t.qty);return t.discount&&`${i(t.discount)}`,e.jsxs("div",{className:"grid grid-cols-1 gap-3 py-3 border-b border-slate-100 sm:grid-cols-[88px_1fr_120px_92px_120px_64px] sm:items-center",children:[e.jsx("div",{className:"h-20 w-20 overflow-hidden rounded-md bg-slate-100",children:e.jsx("img",{src:t.img,alt:t.name,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:t.name}),t.variant&&e.jsx("div",{className:"text-xs text-slate-500",children:t.variant})]}),e.jsx("div",{className:"text-sm font-medium text-slate-700",children:i(t.price)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:r,className:"h-7 w-7 rounded-md border bg-white hover:bg-slate-50",type:"button",children:"−"}),e.jsx("input",{readOnly:!0,value:t.qty,className:"h-7 w-10 rounded-md border text-center text-sm"}),e.jsx("button",{onClick:d,className:"h-7 w-7 rounded-md border bg-white hover:bg-slate-50",type:"button",children:"＋"})]}),e.jsx("div",{className:"text-right font-semibold",children:i(m)}),e.jsx("div",{children:e.jsx("button",{onClick:c,className:"text-xs text-rose-600 hover:text-rose-700",children:"Remove"})})]})}function M({product:t,walletBalance:d=0,defaultAddress:r=null}){const{auth:c}=F().props??{},m=()=>r?e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm text-sm",children:[e.jsxs("div",{className:"font-semibold",children:[r.name," (",r.phone,")"]}),e.jsxs("div",{children:[r.line1,r.line2?`, ${r.line2}`:"",","," ",r.city,", ",r.state," -"," ",r.pincode]}),e.jsx("div",{children:r.country}),e.jsx("div",{className:"mt-3",children:e.jsx("a",{href:"/address",className:"inline-flex items-center rounded-lg border border-sky-600 px-3 py-1.5 text-xs font-medium text-sky-700 hover:bg-sky-50",children:"Change Address"})})]}):e.jsxs("div",{className:"rounded-xl border border-amber-300 bg-amber-50 p-4 text-sm text-amber-800",children:["⚠ No shipping address found."," ",e.jsx("a",{href:"/address",className:"underline font-semibold hover:text-amber-900",children:"Add Address"})]}),[a,h]=o.useState([]),q=s=>h(n=>n.find(x=>x.id===s.id)?n.map(x=>x.id===s.id?{...x,qty:x.qty+1}:x):[...n,{id:s.id,name:s.name,img:s.img,variant:s.variant||null,price:Number(s.price),qty:1,type:"repurchase"}]),P=s=>h(n=>n.map(l=>l.id===s?{...l,qty:l.qty+1}:l)),R=s=>h(n=>n.map(l=>l.id===s&&l.qty>1?{...l,qty:l.qty-1}:l)),$=s=>h(n=>n.filter(l=>l.id!==s)),[v,y]=o.useState(""),[u,g]=o.useState(null),I=s=>{s?.preventDefault?.();const n=(v||"").trim().toUpperCase();if(!n){g(null);return}g(n==="FLAT10"?n:null)},j=o.useMemo(()=>a.reduce((s,n)=>s+Number(n.price)*Number(n.qty),0),[a]),w=o.useMemo(()=>u==="FLAT10"?Math.round(j*.1):0,[u,j]),f=Math.max(0,j-w),[N,C]=o.useState(!1),[p,k]=o.useState({show:!1,title:"",message:"",tone:"neutral"}),b=(s,n,l="success")=>k({show:!0,title:s,message:n,tone:l}),S=()=>{if(!a.length)return b("Cart Empty","Please add items to cart.","error");if(!r)return b("No Address","Please add a shipping address before checkout.","error");if(d<Number(f))return b("Insufficient Balance",`Need ${i(f)} in wallet.`,"error");T.post(route("repurchase.checkout"),{items:a,coupon:u},{preserveScroll:!0,onStart:()=>C(!0),onFinish:()=>C(!1),onSuccess:()=>{const s=a.map(n=>`${n.name} x ${n.qty} = ${i(n.price*n.qty)}`).join(`
`);h([]),g(null),y(""),b("Order Success",`Repurchase order placed!

${s}

Total: ${i(f)}`,"success")},onError:()=>b("Checkout Failed","Something went wrong.","error")})};return e.jsxs(_,{user:c?.user,children:[e.jsx(L,{title:"Repurchase"}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight",children:"Repurchase"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Wallet:"," ",e.jsx("span",{className:"font-semibold text-slate-900",children:i(d)})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Shipping Address"}),e.jsx(m,{})]}),e.jsx("section",{className:"rounded-2xl bg-white p-4 sm:p-6 shadow ring-1 ring-slate-100",children:e.jsxs("div",{className:"grid md:grid-cols-[360px_1fr] gap-6 items-start",children:[e.jsx("img",{src:t.img,alt:t.name,className:"w-[320px] h-[320px] object-cover rounded-2xl bg-slate-50"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:t.name}),e.jsx("p",{className:"text-sm text-slate-500",children:t.variant}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"text-xl font-semibold text-slate-900",children:["₹",t.price.toLocaleString()]}),e.jsxs("div",{className:"text-sm line-through text-slate-500",children:["₹",t.mrp.toLocaleString()]}),e.jsxs("div",{className:"text-sm text-green-600 font-medium",children:["Save ₹",t.discount.toLocaleString()," (",t.discountPercent,"%)"]})]}),e.jsxs("div",{className:"mt-3 text-sm text-slate-700 space-y-1",children:[e.jsxs("div",{children:["• Bottles: ",t.bottles]}),e.jsxs("div",{children:["• Gummies per Bottle: ",t.gummiesPerBottle]}),e.jsxs("div",{children:["• Total Gummies: ",t.totalGummies]})]}),e.jsxs("div",{className:"mt-4 flex w-full flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>q(t),className:"w-full sm:w-auto rounded-lg border border-indigo-600 px-4 py-2.5 text-sm font-semibold text-indigo-700 hover:bg-indigo-50",type:"button",children:"Add to Cart"}),e.jsx("button",{onClick:S,disabled:N,className:"w-full sm:w-auto rounded-lg bg-gradient-to-r from-indigo-600 to-blue-600 px-4 py-2.5 text-sm font-semibold text-white hover:from-indigo-700 hover:to-blue-700 disabled:opacity-60",type:"button",children:N?"Processing...":"Buy Now"})]})]})]})}),a.length>0&&e.jsxs("section",{className:"rounded-2xl bg-white p-4 sm:p-6 shadow ring-1 ring-slate-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Cart"}),e.jsx("div",{className:"divide-y divide-slate-100",children:a.map(s=>e.jsx(B,{it:s,onInc:()=>P(s.id),onDec:()=>R(s.id),onRemove:()=>$(s.id)},s.id))}),e.jsxs("form",{onSubmit:I,className:"mt-4 flex items-center gap-2",children:[e.jsx("input",{value:v,onChange:s=>y(s.target.value),placeholder:"Have a coupon? e.g., FLAT10",className:"flex-1 rounded-lg border border-slate-300 px-3 py-2 text-sm"}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700",children:"Apply"}),u&&e.jsxs("span",{className:"text-xs font-medium text-emerald-700",children:["Applied: ",u]})]}),e.jsxs("div",{className:"mt-4 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:i(j)})]}),e.jsxs("div",{className:"flex justify-between text-emerald-700",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["- ",i(w)]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:i(f)})]})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:S,disabled:N,className:"flex-1 rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-60",children:N?"Processing...":"Proceed to Checkout"})})]})]}),e.jsx(A,{open:p.show,title:p.title,message:p.message,tone:p.tone,onClose:()=>k({...p,show:!1})})]})}export{M as default};
