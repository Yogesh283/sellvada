import{b as L,r as x,j as e,H as R,a as D}from"./app-CvkHuXaX.js";import{A as O}from"./AuthenticatedLayout-v90o_MEE.js";const n=a=>Number(a??0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),S=({children:a,className:c=""})=>e.jsx("div",{className:`rounded-2xl border border-slate-200 bg-white shadow-sm ${c}`,children:a}),u=({className:a="",...c})=>e.jsx("button",{...c,type:c.type??"button",className:`inline-flex items-center justify-center rounded-md px-3 py-2 text-sm font-semibold transition
    bg-sky-600 text-white hover:bg-sky-700 disabled:opacity-50 disabled:cursor-not-allowed ${a}`});function Q({p:a,onAdd:c}){return e.jsxs(S,{className:"h-full",children:[e.jsxs("div",{className:"p-4 flex gap-4",children:[e.jsx("img",{src:a.img,alt:a.name,className:"h-20 w-20 shrink-0 rounded object-cover border",onError:i=>i.currentTarget.src="/images/placeholder.png"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-slate-900 truncate",children:a.name}),e.jsx("div",{className:"text-slate-500 text-sm",children:a.variant}),e.jsxs("div",{className:"mt-2 text-lg font-bold text-slate-900",children:["₹ ",n(a.price)]})]}),e.jsx("div",{className:"hidden sm:flex items-center",children:e.jsx(u,{onClick:()=>c(a),children:"Add"})})]}),e.jsx("div",{className:"px-4 pb-4 sm:hidden",children:e.jsx(u,{className:"w-full",onClick:()=>c(a),children:"Add to cart"})})]})}function T({value:a,onChange:c,min:i=1}){const p=()=>c(Math.max(i,Number(a)-1)),l=()=>c(Number(a)+1);return e.jsxs("div",{className:"inline-flex items-stretch overflow-hidden rounded-md border border-slate-200",children:[e.jsx("button",{type:"button",onClick:p,className:"px-2 text-slate-700 hover:bg-slate-50",children:"–"}),e.jsx("input",{type:"number",min:i,value:a,onChange:o=>c(Math.max(i,Number(o.target.value)||i)),className:"w-16 text-center outline-none border-x border-slate-200"}),e.jsx("button",{type:"button",onClick:l,className:"px-2 text-slate-700 hover:bg-slate-50",children:"+"})]})}function z(){const{catalog:a=[],defaults:c={},errors:i={},flash:p={}}=L().props,[l,o]=x.useState([]),[h,q]=x.useState(""),[j,A]=x.useState(c?.shipping??49),[m,g]=x.useState(!1),M=s=>{o(t=>{const d=t.findIndex(r=>r.id===s.id);if(d>=0){const r=[...t];return r[d]={...r[d],qty:r[d].qty+1},r}return[...t,{id:s.id,name:s.name,price:s.price,qty:1,img:s.img,variant:s.variant,type:s.type}]}),console.log("Added:",s.name)},f=(s,t)=>{o(d=>d.map(r=>r.id===s?{...r,qty:Math.max(1,Number(t)||1)}:r).filter(r=>r.qty>0))},v=s=>o(t=>t.filter(d=>d.id!==s)),y=()=>o([]),N=x.useMemo(()=>l.reduce((s,t)=>s+Number(t.price)*Number(t.qty),0),[l]),w=x.useMemo(()=>(h||"").trim().toUpperCase()==="FLAT10"?Math.round(N*.1):0,[h,N]),C=Math.max(0,N-w),k=Math.round(C*.05),P=C+k+(l.length?Number(j||0):0),b=()=>{if(!l.length){alert("Cart is empty");return}const s={items:l.map(({id:t,name:d,price:r,qty:E,img:F,variant:B,type:I})=>({id:t,name:d,price:r,qty:E,img:F,variant:B,type:I})),coupon:h?h.trim():null,shipping:Number(j||0)};console.log("POST /checkout",s),g(!0),D.post("/checkout",s,{preserveScroll:!0,onSuccess:()=>{y(),console.log("Order placed OK")},onError:t=>{console.warn("Checkout validation errors:",t)},onFinish:()=>g(!1)})};return e.jsxs(O,{header:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold leading-tight text-slate-800",children:"Buy"}),e.jsxs("span",{className:"ml-2 rounded-full bg-slate-100 text-slate-700 text-xs px-2 py-0.5",children:["Cart: ",l.reduce((s,t)=>s+t.qty,0)]})]}),children:[e.jsx(R,{title:"Buy"}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-6 lg:px-8 py-6 space-y-6",children:[p?.success&&e.jsx("div",{className:"rounded-md bg-emerald-50 text-emerald-700 px-3 py-2",children:p.success}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4",children:a.map(s=>e.jsx(Q,{p:s,onAdd:M},s.id))}),e.jsxs(S,{children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-200 flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-slate-800",children:"Your Cart"}),e.jsx(u,{onClick:b,disabled:!l.length||m,className:"hidden md:inline-flex",children:m?"Processing…":"Proceed to Checkout"})]}),e.jsx("div",{className:"p-4",children:l.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 md:hidden",children:l.map(s=>e.jsxs("div",{className:"rounded-lg border border-slate-200 p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.img,alt:s.name,className:"h-12 w-12 rounded object-cover border",onError:t=>t.currentTarget.src="/images/placeholder.png"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-slate-900 truncate",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500",children:s.variant}),e.jsx("div",{className:"mt-1 text-xs uppercase text-slate-500",children:s.type})]}),e.jsx("button",{onClick:()=>v(s.id),className:"text-rose-600 text-xs underline",children:"Remove"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"text-slate-600 text-sm",children:["Price: ",e.jsxs("span",{className:"font-medium",children:["₹ ",n(s.price)]})]}),e.jsx(T,{value:s.qty,onChange:t=>f(s.id,t)})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600 text-sm",children:"Total"}),e.jsxs("span",{className:"font-semibold",children:["₹ ",n(s.price*s.qty)]})]})]},s.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-slate-500 border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Product"}),e.jsx("th",{className:"py-2 pr-4",children:"Type"}),e.jsx("th",{className:"py-2 pr-4",children:"Price"}),e.jsx("th",{className:"py-2 pr-4",children:"Qty"}),e.jsx("th",{className:"py-2 pr-4",children:"Total"}),e.jsx("th",{className:"py-2"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:s.img,alt:s.name,className:"h-10 w-10 rounded object-cover border",onError:t=>t.currentTarget.src="/images/placeholder.png"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900",children:s.name}),e.jsx("div",{className:"text-xs text-slate-500",children:s.variant})]})]})}),e.jsx("td",{className:"py-2 pr-4 uppercase",children:s.type}),e.jsxs("td",{className:"py-2 pr-4",children:["₹ ",n(s.price)]}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx(T,{value:s.qty,onChange:t=>f(s.id,t)})}),e.jsxs("td",{className:"py-2 pr-4 font-medium",children:["₹ ",n(s.price*s.qty)]}),e.jsx("td",{className:"py-2",children:e.jsx("button",{onClick:()=>v(s.id),className:"text-rose-600 hover:underline",type:"button",children:"Remove"})})]},s.id))})]})}),e.jsxs("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Coupon"}),e.jsx("input",{value:h,onChange:s=>q(s.target.value),placeholder:"e.g. FLAT10",className:"w-full rounded border border-slate-200 px-3 py-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Shipping"}),e.jsx("input",{type:"number",min:0,value:j,onChange:s=>A(s.target.value),className:"w-full rounded border border-slate-200 px-3 py-2"})]})]}),e.jsxs("div",{className:"mt-6 grid gap-2 md:grid-cols-2",children:[e.jsx("div",{}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Subtotal"}),e.jsxs("span",{className:"font-medium text-slate-900",children:["₹ ",n(N)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Discount"}),e.jsxs("span",{className:"font-medium text-slate-900",children:["₹ ",n(w)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Tax (5%)"}),e.jsxs("span",{className:"font-medium text-slate-900",children:["₹ ",n(k)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Shipping"}),e.jsxs("span",{className:"font-medium text-slate-900",children:["₹ ",n(l.length?j:0)]})]}),e.jsxs("div",{className:"mt-2 border-t pt-2 flex justify-between text-base",children:[e.jsx("span",{className:"font-semibold text-slate-800",children:"Grand Total"}),e.jsxs("span",{className:"font-bold text-slate-900",children:["₹ ",n(P)]})]}),e.jsxs("div",{className:"mt-3 flex gap-2 flex-col sm:flex-row sm:justify-end",children:[e.jsx("button",{type:"button",onClick:y,className:"rounded-md border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50",children:"Clear"}),e.jsx(u,{onClick:b,disabled:!l.length||m,className:"sm:min-w-[160px]",children:m?"Processing…":"Proceed to Checkout"})]})]})]})]}):e.jsx("div",{className:"text-slate-600 text-sm",children:"No items yet. Add products from above."})})]}),l.length>0&&e.jsx("div",{className:"fixed bottom-3 left-3 right-3 z-40 md:hidden",children:e.jsxs("div",{className:"flex items-center justify-between rounded-xl bg-slate-900 text-white px-4 py-3 shadow-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs opacity-80",children:"Payable"}),e.jsxs("div",{className:"text-lg font-semibold",children:["₹ ",n(P)]})]}),e.jsx(u,{onClick:b,disabled:m,className:"bg-emerald-600 hover:bg-emerald-700",children:m?"Processing…":"Proceed"})]})})]})]})}export{z as default};
