import{b as D,r as d,j as e,H as F,c as W}from"./app-CoGFq9Yn.js";import{A as $}from"./AuthenticatedLayout-arLKs0NG.js";const c=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Number(t||0)),O="cart",H=()=>{try{const t=localStorage.getItem(O);return t?JSON.parse(t):[]}catch{return[]}},y=t=>{try{localStorage.setItem(O,JSON.stringify(t))}catch{}};function P({onClick:t,children:m,disabled:r,"aria-label":n}){return e.jsx("button",{onClick:t,"aria-label":n,disabled:r,className:"h-10 w-10 sm:h-9 sm:w-9 rounded-lg border border-slate-200 bg-white text-slate-700 hover:bg-slate-50 active:scale-[0.98] disabled:opacity-40",type:"button",children:m})}function J({item:t,onInc:m,onDec:r,onRemove:n}){const x=Number(t.price)*Number(t.qty||0);return e.jsxs("div",{className:"grid grid-cols-[64px_1fr_auto] sm:grid-cols-[90px_1fr_auto_auto] gap-3 sm:gap-4 items-center border-b border-slate-100 py-3 sm:py-4",children:[e.jsx("div",{className:"h-16 w-16 sm:h-20 sm:w-20 overflow-hidden rounded-md bg-slate-100",children:e.jsx("img",{src:t.img,alt:t.name,className:"h-full w-full object-cover object-center",loading:"lazy",decoding:"async"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[13px] sm:text-base font-semibold text-slate-900 line-clamp-2",children:t.name}),t.variant?e.jsx("div",{className:"text-[11px] sm:text-xs text-slate-500 line-clamp-1",children:t.variant}):null,e.jsx("div",{className:"mt-1 text-[13px] text-slate-700 sm:hidden",children:c(t.price)})]}),e.jsx("div",{className:"hidden sm:block text-sm font-medium text-slate-700",children:c(t.price)}),e.jsxs("div",{className:"col-span-3 sm:col-span-1 flex items-center justify-between sm:justify-end gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx(P,{onClick:r,"aria-label":"Decrease quantity",disabled:t.qty<=1,children:"−"}),e.jsx("input",{readOnly:!0,value:t.qty,className:"h-9 w-12 sm:w-14 rounded-lg border border-slate-200 bg-white text-center text-sm"}),e.jsx(P,{onClick:m,"aria-label":"Increase quantity",children:"＋"})]}),e.jsx("div",{className:"min-w-[80px] sm:min-w-[96px] text-right font-semibold text-slate-900",children:c(x)}),e.jsx("button",{onClick:n,className:"text-[12px] sm:text-xs text-rose-600 hover:text-rose-700",type:"button",children:"Remove"})]})]})}function U({items:t=null}){const{walletBalance:m=0,defaultAddress:r=null}=D().props,[n,x]=d.useState(t||[]),[N,b]=d.useState(null),[v,w]=d.useState("success"),T=s=>{w("success"),b(s),setTimeout(()=>b(null),2500)},o=s=>{w("error"),b(s||"Something went wrong."),setTimeout(()=>b(null),2500)};d.useEffect(()=>{if(t)y(t);else{const s=H();s.length&&x(s)}},[]),d.useEffect(()=>{y(n)},[n]);const[K,q]=d.useState(""),[p,I]=d.useState(null),[i,k]=d.useState(!1),[M,h]=d.useState(!1),[_,g]=d.useState(!1),[C,z]=d.useState(null),f=d.useMemo(()=>n.reduce((s,a)=>s+Number(a.price)*Number(a.qty||0),0),[n]),j=d.useMemo(()=>p&&p==="FLAT10"?Math.round(f*.1):0,[p,f]),u=Math.max(0,f-j),B=s=>x(a=>a.map(l=>l.id===s?{...l,qty:(l.qty||0)+1}:l)),R=s=>x(a=>a.map(l=>l.id===s&&l.qty>1?{...l,qty:l.qty-1}:l)),E=s=>x(a=>a.filter(l=>l.id!==s)),L=()=>{x([]),y([]),I(null),q("")},S=s=>{if(s?.preventDefault(),!n.length){o("Your cart is empty. Add products before checkout.");return}i||h(!0)},Y=async()=>{if(!n.length){h(!1),o("Your cart is empty. Add products before checkout.");return}if(!i){if(!r){h(!1),o("Please add a shipping address before checkout.");return}if(m<Number(u)){h(!1),o(`Insufficient wallet balance to pay ${c(u)}.`);return}try{k(!0);const s={items:n,coupon:p,shipping:0},a=await W.post("/checkout",s);if(a?.data?.success){const l=a.data.order_no||null;z(l),L(),h(!1),g(!0),T(a.data.message||"Order placed successfully!")}else o(a&&a.data&&a.data.message||"Checkout failed.")}catch(s){if(console.error("checkout error",s),s.response&&s.response.status===422){const a=s.response.data?.errors||s.response.data||{};if(a?.wallet)o(a.wallet[0]||a.wallet);else if(typeof a=="object"&&Object.keys(a).length){const l=Object.values(a)[0];o(Array.isArray(l)?l[0]:l)}else o("Validation failed. Please check your input.")}else s.response&&s.response.data&&s.response.data.message?o(s.response.data.message):o("Checkout failed. Please try again.")}finally{k(!1)}}},A=()=>{i||h(!1)};return e.jsxs($,{children:[e.jsx(F,{title:"Your Cart"}),e.jsxs("div",{className:"bg-slate-50 overflow-x-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-cyan-600 via-sky-600 to-blue-600",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-6 py-3 sm:py-6 flex items-center gap-3",children:[e.jsx("img",{src:"/image/11111.png",alt:"Brand",className:"h-7 w-auto sm:h-10 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-base sm:text-3xl font-bold text-white",children:"Your Shopping Cart"}),e.jsx("p",{className:"text-white/90 text-[12px] sm:text-sm truncate",children:"Review your items and proceed to checkout."})]})]})}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-6 py-4 sm:py-8 grid gap-4 sm:gap-6 lg:grid-cols-[1.2fr_.8fr]",children:[e.jsxs("section",{className:"rounded-2xl bg-white p-4 sm:p-6 shadow ring-1 ring-slate-100",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Shipping Address"}),e.jsx("a",{href:"/address",className:"text-indigo-600 text-sm hover:underline",children:"Manage Addresses"})]}),r?e.jsxs("div",{className:"mt-2 rounded-md border border-slate-200 bg-slate-50 px-3 py-2 text-sm",children:[e.jsxs("div",{className:"font-semibold",children:[r.name," (",r.phone,")"]}),e.jsxs("div",{children:[r.line1,r.line2?`, ${r.line2}`:"",","," ",r.city,", ",r.state," - ",r.pincode]}),e.jsx("div",{children:r.country})]}):e.jsxs("div",{className:"mt-2 rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:["No address found. Please add an address before checkout."," ",e.jsx("a",{href:"/address",className:"underline",children:"Add Address"})]})]}),n.length===0?e.jsxs("div",{className:"py-10 sm:py-16 text-center",children:[e.jsx("div",{className:"text-lg sm:text-xl font-semibold text-slate-900",children:"Your cart is empty"}),e.jsx("p",{className:"mt-1 text-slate-600",children:"Add products to continue shopping."}),e.jsx("a",{href:"/",className:"mt-4 inline-flex w-full sm:w-auto justify-center rounded-lg bg-sky-600 px-4 py-2.5 text-white font-semibold hover:bg-sky-700",children:"Browse Products"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden sm:grid grid-cols-[90px_1fr_auto_auto] gap-4 border-b border-slate-200 pb-3 text-xs font-semibold text-slate-500 uppercase tracking-wide",children:[e.jsx("div",{children:"Item"}),e.jsx("div",{children:"Product"}),e.jsx("div",{children:"Price"}),e.jsx("div",{className:"text-right",children:"Total"})]}),e.jsx("div",{className:"divide-y divide-slate-100",children:n.map(s=>e.jsx(J,{item:s,onInc:()=>B(s.id),onDec:()=>R(s.id),onRemove:()=>E(s.id)},s.id))})]})]}),e.jsxs("aside",{className:"h-max rounded-2xl bg-white p-4 sm:p-6 shadow ring-1 ring-slate-100 lg:sticky lg:top-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-slate-900",children:"Order Summary"}),e.jsxs("div",{className:"mt-2 rounded-lg bg-slate-50 px-3 py-2 text-[13px] sm:text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Wallet Balance"}),e.jsx("span",{className:"font-semibold text-slate-900",children:c(m)})]}),m<Number(u)&&e.jsxs("div",{className:"mt-1 text-[12px] text-rose-600",children:["Not enough balance to pay ",c(u),"."]})]}),e.jsxs("div",{className:"mt-3 space-y-1.5 sm:space-y-2 text-[13px] sm:text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-600",children:"Subtotal"}),e.jsx("span",{className:"font-medium text-slate-900",children:c(f)})]}),p&&j>0&&e.jsxs("div",{className:"flex items-center justify-between text-emerald-700",children:[e.jsx("span",{children:"Coupon Discount"}),e.jsxs("span",{children:["-",c(j)]})]}),e.jsx("div",{className:"my-2 border-t border-slate-200"}),e.jsxs("div",{className:"flex items-center justify-between text-base font-bold text-slate-900",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:c(u)})]})]}),e.jsxs("div",{className:"mt-4 sm:mt-5 grid gap-2 sm:gap-3",children:[e.jsx("button",{onClick:S,disabled:i||n.length===0,className:"w-full inline-flex items-center justify-center rounded-lg bg-gradient-to-r from-cyan-600 via-sky-600 to-blue-600 px-5 py-2.5 text-white font-semibold hover:from-cyan-700 hover:to-blue-700 disabled:opacity-60",type:"button",children:i?"Processing...":"Proceed to Checkout"}),e.jsx("a",{href:"/",className:"w-full inline-flex items-center justify-center rounded-lg border border-slate-200 px-5 py-2.5 text-slate-700 font-semibold hover:bg-slate-50",children:"Continue Shopping"})]}),!r&&e.jsxs("div",{className:"mt-3 rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-[12px] text-amber-800",children:["Please select a shipping address before checkout."," ",e.jsx("a",{href:"/address",className:"underline",children:"Add Address"})]}),e.jsx("div",{className:"mt-6 text-[11px] text-slate-500",children:"Payments supported: UPI, Cards, NetBanking. Secure checkout."})]})]}),n.length>0&&e.jsx("div",{className:"lg:hidden sticky bottom-0 inset-x-0 border-t border-slate-200 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/60",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-2 sm:px-6 sm:py-3 flex items-center justify-between gap-3",style:{paddingBottom:"calc(env(safe-area-inset-bottom, 0px) + 8px)"},children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-slate-600",children:"Total"}),e.jsx("div",{className:"font-semibold text-slate-900",children:c(u)})]}),e.jsx("button",{onClick:S,disabled:i||n.length===0,className:"inline-flex flex-1 justify-center rounded-lg bg-sky-600 px-4 py-2.5 text-white font-semibold hover:bg-sky-700 disabled:opacity-60",type:"button",children:i?"Processing...":"Checkout"})]})})]}),M&&e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{i||A()}}),e.jsxs("div",{className:"relative z-50 w-full max-w-md rounded-lg bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"text-2xl font-semibold text-slate-900 text-center",children:"Confirm this action?"}),e.jsxs("p",{className:"mt-4 text-center text-slate-700",children:["Are you sure you want to place order for ",e.jsx("strong",{children:c(u)}),"?"]}),e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-4",children:[e.jsx("button",{onClick:A,disabled:i,className:"px-6 py-2 rounded-md bg-slate-400 text-white font-medium hover:opacity-90",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:i,className:"px-6 py-2 rounded-md bg-blue-500 text-white font-medium hover:bg-blue-600",children:i?"Processing...":"OK"})]})]})]}),_&&e.jsxs("div",{className:"fixed inset-0 z-[100000] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>g(!1)}),e.jsxs("div",{className:"relative z-50 w-full max-w-md rounded-lg bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-emerald-700",children:"Order Confirmed"}),e.jsxs("p",{className:"mt-2 text-sm text-slate-600",children:["Your order has been placed successfully.",e.jsx("span",{className:"block",children:"Delivery time: 7 - 15 days"}),C&&e.jsxs("span",{className:"block mt-2 font-medium",children:["Order No: ",C]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("a",{href:"/orders",className:"rounded-lg bg-sky-600 px-3 py-2 text-sm font-medium text-white hover:bg-sky-700",children:"View Orders"}),e.jsx("button",{onClick:()=>g(!1),className:"rounded-lg border px-3 py-2 text-sm font-medium",children:"Close"})]})]})]}),N&&e.jsx("div",{className:"fixed left-1/2 z-[9999] -translate-x-1/2",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 16px)"},children:e.jsx("div",{className:`rounded-lg px-3 sm:px-4 py-2.5 sm:py-3 text-white shadow-lg ring-1 ${v==="error"?"bg-rose-600 ring-rose-500/40":"bg-emerald-600 ring-emerald-500/40"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:v==="error"?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v4m0 4h.01M4.93 4.93l14.14 14.14M12 2a10 10 0 100 20 10 10 0 000-20z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m5 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-[13px] sm:text-sm font-medium",children:N})]})})})]})}export{U as default};
