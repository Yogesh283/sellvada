import{c as L,r as x,j as e,H as M,a as A}from"./app-DZTb9xMf.js";import{A as O}from"./AuthenticatedLayout-BtE7vf5j.js";const i=r=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(Number(r||0));function D({open:r,title:c,message:a,tone:u="neutral",onClose:h}){if(!r)return null;const o=u==="success"?"ring-emerald-400":u==="error"?"ring-rose-400":"ring-cyan-400";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:`w-full max-w-md rounded-2xl bg-white shadow-xl ring ${o} ring-1`,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:c}),e.jsx("button",{onClick:h,className:"rounded-md p-1 text-slate-500 hover:bg-slate-100",children:"✕"})]}),e.jsx("div",{className:"p-4 text-slate-700 whitespace-pre-line",children:a}),e.jsx("div",{className:"flex justify-end border-t border-slate-200 p-3",children:e.jsx("button",{onClick:h,className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700",children:"Close"})})]})})}function E({it:r,onInc:c,onDec:a,onRemove:u}){const h=Number(r.price)*Number(r.qty);return e.jsxs("div",{className:"grid grid-cols-1 gap-3 py-3 border-b border-slate-100 sm:grid-cols-[88px_1fr_120px_92px_120px_64px] sm:items-center",children:[e.jsx("div",{className:"h-20 w-20 overflow-hidden rounded-md bg-slate-100",children:e.jsx("img",{src:r.img,alt:r.name,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:r.name}),r.variant&&e.jsx("div",{className:"text-xs text-slate-500",children:r.variant})]}),e.jsx("div",{className:"text-sm font-medium text-slate-700",children:i(r.price)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:a,className:"h-7 w-7 rounded-md border bg-white hover:bg-slate-50",type:"button",children:"−"}),e.jsx("input",{readOnly:!0,value:r.qty,className:"h-7 w-10 rounded-md border text-center text-sm"}),e.jsx("button",{onClick:c,className:"h-7 w-7 rounded-md border bg-white hover:bg-slate-50",type:"button",children:"＋"})]}),e.jsx("div",{className:"text-right font-semibold",children:i(h)}),e.jsx("div",{children:e.jsx("button",{onClick:u,className:"text-xs text-rose-600 hover:text-rose-700",children:"Remove"})})]})}function B({product:r,walletBalance:c=0,defaultAddress:a=null}){const{auth:u}=L().props??{},h=()=>a?e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-sm text-sm",children:[e.jsxs("div",{className:"font-semibold",children:[a.name," (",a.phone,")"]}),e.jsxs("div",{children:[a.line1,a.line2?`, ${a.line2}`:"",", ",a.city,", ",a.state," - ",a.pincode]}),e.jsx("div",{children:a.country}),e.jsx("div",{className:"mt-3",children:e.jsx("a",{href:"/address",className:"inline-flex items-center rounded-lg border border-sky-600 px-3 py-1.5 text-xs font-medium text-sky-700 hover:bg-sky-50",children:"Change Address"})})]}):e.jsxs("div",{className:"rounded-xl border border-amber-300 bg-amber-50 p-4 text-sm text-amber-800",children:["⚠ No shipping address found. ",e.jsx("a",{href:"/address",className:"underline font-semibold hover:text-amber-900",children:"Add Address"})]}),[o,g]=x.useState([]),R=s=>g(n=>n.map(t=>t.id===s?{...t,qty:t.qty+1}:t)),q=s=>g(n=>n.map(t=>t.id===s&&t.qty>1?{...t,qty:t.qty-1}:t)),$=s=>g(n=>n.filter(t=>t.id!==s)),[w,C]=x.useState(""),[d,j]=x.useState(null),_=s=>{s?.preventDefault?.();const n=(w||"").trim().toUpperCase();if(!n){j(null);return}j(n==="FLAT10"?n:null)},f=x.useMemo(()=>o.reduce((s,n)=>s+Number(n.price)*Number(n.qty),0),[o]),k=x.useMemo(()=>d==="FLAT10"?Math.round(f*.1):0,[d,f]),N=Math.max(0,f-k),[v,y]=x.useState(!1),[b,S]=x.useState({show:!1,title:"",message:"",tone:"neutral"}),m=(s,n,t="success")=>S({show:!0,title:s,message:n,tone:t}),P=(s,n=null)=>{y(!0),A.post(route("repurchase.repurchaseOrder"),s,{preserveScroll:!0,onStart:()=>y(!0),onFinish:()=>y(!1),onSuccess:()=>{const t=(s.items||[]).map(l=>`${l.name||l.id} x ${l.qty} = ${i(l.price*l.qty)}`).join(`
`);s.skip_clear_cart||g([]),j(null),C(""),m("Order Success",`${n??"Repurchase order placed!"}

${t}

Total: ${i(s.total||(s.items||[]).reduce((l,p)=>l+p.price*p.qty,0))}`,"success")},onError:t=>{console.error("Order error:",t);let l="Something went wrong.";t?.response?.data?.errors?l=Object.values(t.response.data.errors).flat().join(" | "):t?.response?.data?.message&&(l=t.response.data.message),m("Checkout Failed",l,"error")}})},T=s=>{if(!a)return m("No Address","Please add a shipping address before checkout.","error");const n=1,t=Number(s.price)*n,l=d==="FLAT10"?Math.round(t*.1):0,p=Math.max(0,t-l);if(c<Number(p))return m("Insufficient Balance",`Need ${i(p)} in wallet.`,"error");const I={items:[{id:s.id,name:s.name,img:s.img,variant:s.variant||null,price:Number(s.price),qty:n,type:"repurchase"}],coupon:d,shipping:0,total:p,skip_clear_cart:!0};P(I,`Repurchase of ${s.name} (x${n}) successful.`)},F=()=>{if(!o.length)return m("Cart Empty","Please add items to cart.","error");if(!a)return m("No Address","Please add a shipping address before checkout.","error");if(c<Number(N))return m("Insufficient Balance",`Need ${i(N)} in wallet.`,"error");P({items:o,coupon:d,shipping:0,total:N},"Repurchase order placed!")};return e.jsxs(O,{user:u?.user,children:[e.jsx(M,{title:"Repurchase"}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight",children:"Repurchase"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Wallet: ",e.jsx("span",{className:"font-semibold text-slate-900",children:i(c)})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Shipping Address"}),e.jsx(h,{})]}),e.jsx("section",{className:"rounded-2xl bg-white p-4 sm:p-6 shadow ring-1 ring-slate-100",children:e.jsxs("div",{className:"grid md:grid-cols-[360px_1fr] gap-6 items-start",children:[e.jsx("img",{src:r.img,alt:r.name,className:"w-[320px] h-[320px] object-cover rounded-2xl bg-slate-50"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:r.name}),e.jsx("p",{className:"text-sm text-slate-500",children:r.variant}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"text-xl font-semibold text-slate-900",children:["₹",r.price.toLocaleString()]}),e.jsxs("div",{className:"text-sm line-through text-slate-500",children:["₹",r.mrp.toLocaleString()]}),e.jsxs("div",{className:"text-sm text-green-600 font-medium",children:["Save ₹",r.discount.toLocaleString()," (",r.discountPercent,"%)"]})]}),e.jsx("div",{className:"mt-4 flex w-full flex-col sm:flex-row gap-2",children:e.jsx("button",{onClick:()=>T(r),disabled:v,className:"w-full sm:w-auto rounded-lg bg-gradient-to-r from-indigo-600 to-blue-600 px-4 py-2.5 text-sm font-semibold text-white hover:from-indigo-700 hover:to-blue-700 disabled:opacity-60",type:"button",children:v?"Processing...":"Buy Now"})})]})]})}),o.length>0&&e.jsxs("section",{className:"rounded-2xl bg-white p-4 sm:p-6 shadow ring-1 ring-slate-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Cart"}),e.jsx("div",{className:"divide-y divide-slate-100",children:o.map(s=>e.jsx(E,{it:s,onInc:()=>R(s.id),onDec:()=>q(s.id),onRemove:()=>$(s.id)},s.id))}),e.jsxs("form",{onSubmit:_,className:"mt-4 flex items-center gap-2",children:[e.jsx("input",{value:w,onChange:s=>C(s.target.value),placeholder:"Have a coupon? e.g., FLAT10",className:"flex-1 rounded-lg border border-slate-300 px-3 py-2 text-sm"}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700",children:"Apply"}),d&&e.jsxs("span",{className:"text-xs font-medium text-emerald-700",children:["Applied: ",d]})]}),e.jsxs("div",{className:"mt-4 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:i(f)})]}),e.jsxs("div",{className:"flex justify-between text-emerald-700",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["- ",i(k)]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:i(N)})]})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:F,disabled:v,className:"flex-1 rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-60",children:v?"Processing...":"Proceed to Checkout"})})]})]}),e.jsx(D,{open:b.show,title:b.title,message:b.message,tone:b.tone,onClose:()=>S({...b,show:!1})})]})}export{B as default};
