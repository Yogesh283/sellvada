import{r as i,u as D,j as e,H as F}from"./app-CVJZFAsL.js";import{A}from"./AuthenticatedLayout-2phaPt0u.js";function n(c){try{return new Intl.NumberFormat("en-IN",{maximumFractionDigits:2}).format(Number(c||0))}catch{return c}}function W({balance:c,rows:p,methods:j,minAmt:m=200,chargePct:f=0,chargeFix:y=0}){const[x,u]=i.useState(Number(c||0)),[d,v]=i.useState(j?.[0]||"UPI"),[N,r]=i.useState(""),{data:a,setData:l,post:w,processing:b,reset:_,errors:s,clearErrors:k}=D({amount:"",method:d,upi_id:"",account_name:"",bank_name:"",account_no:"",ifsc:""});i.useEffect(()=>{l("method",d)},[d,l]),i.useEffect(()=>{u(Number(c||0))},[c]);const S=t=>{v(t),l("method",t)},g=()=>{const t=Number(a.amount||0);return Math.max(0,t*Number(f||0)/100+Number(y||0))},C=()=>Math.max(0,Number(a.amount||0)-g()),E=()=>{r(""),k();const t=Number(a.amount||0);return!t||t<=0?(r("Please enter a valid amount."),!1):t<Number(m||0)?(r(`Minimum withdrawal amount is ₹${n(m)}.`),!1):t>x?(r("Insufficient wallet balance for this withdrawal."),!1):!0},I=t=>{if(t.preventDefault(),!E())return;const q=Number(a.amount||0),M=x;u(h=>Number((h-q).toFixed(2))),w(route("wallet.withdraw.store"),{onSuccess:()=>{_(),r("")},onError:h=>{u(M);const o=Object.values(h||{});o.length?r(Array.isArray(o)?o.slice(0,3).join(" | "):String(o)):r("Server error occurred. Please try again.")},onFinish:()=>{}})};return e.jsxs(A,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Withdraw"}),children:[e.jsx(F,{title:"Withdraw"}),e.jsxs("div",{className:"max-w-5xl mx-auto p-4 space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow p-5 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Wallet Balance"}),e.jsxs("div",{className:"text-3xl font-bold",children:["₹ ",n(x)]})]})}),e.jsxs("form",{onSubmit:I,className:"bg-white rounded-xl shadow p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Amount (₹)"}),e.jsx("input",{type:"number",min:m,step:"0.01",value:a.amount,onChange:t=>{r(""),l("amount",t.target.value)},className:"mt-1 w-full rounded-lg border-gray-300",required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Minimum ₹",n(m)]}),s.amount&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:s.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Method"}),e.jsx("select",{className:"mt-1 w-full rounded-lg border-gray-300",value:d,onChange:t=>S(t.target.value),children:j?.map(t=>e.jsx("option",{value:t,children:t},t))}),s.method&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:s.method})]}),d==="UPI"?e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:"UPI ID"}),e.jsx("input",{type:"text",value:a.upi_id,onChange:t=>l("upi_id",t.target.value),className:"mt-1 w-full rounded-lg border-gray-300",placeholder:"yourname@bank",required:!0}),s.upi_id&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:s.upi_id})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Account Holder Name"}),e.jsx("input",{className:"mt-1 w-full rounded-lg border-gray-300",value:a.account_name,onChange:t=>l("account_name",t.target.value),required:!0}),s.account_name&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:s.account_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Bank Name"}),e.jsx("input",{className:"mt-1 w-full rounded-lg border-gray-300",value:a.bank_name,onChange:t=>l("bank_name",t.target.value),required:!0}),s.bank_name&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:s.bank_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Account No."}),e.jsx("input",{className:"mt-1 w-full rounded-lg border-gray-300",value:a.account_no,onChange:t=>l("account_no",t.target.value),required:!0}),s.account_no&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:s.account_no})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"IFSC"}),e.jsx("input",{className:"mt-1 w-full rounded-lg border-gray-300",value:a.ifsc,onChange:t=>l("ifsc",t.target.value),required:!0}),s.ifsc&&e.jsx("p",{className:"text-red-600 text-xs mt-1",children:s.ifsc})]})]})]}),e.jsxs("div",{className:"mt-2 rounded-lg bg-gray-50 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Estimated charge"}),e.jsxs("span",{children:["₹ ",n(g())]})]}),e.jsxs("div",{className:"flex items-center justify-between font-semibold",children:[e.jsx("span",{children:"Net payout"}),e.jsxs("span",{children:["₹ ",n(C())]})]})]}),N&&e.jsx("div",{className:"text-sm text-red-600",children:N}),e.jsx("button",{type:"submit",disabled:b,className:"px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold disabled:opacity-50",children:b?"Submitting...":"Request Withdrawal"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Recent Requests"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left",children:[e.jsx("th",{className:"px-3 py-2",children:"ID"}),e.jsx("th",{className:"px-3 py-2",children:"Date"}),e.jsx("th",{className:"px-3 py-2",children:"Amount"}),e.jsx("th",{className:"px-3 py-2",children:"Net"}),e.jsx("th",{className:"px-3 py-2",children:"Method"}),e.jsx("th",{className:"px-3 py-2",children:"Status"}),e.jsx("th",{className:"px-3 py-2",children:"Ref"})]})}),e.jsx("tbody",{children:p?.length?p.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:t.id}),e.jsx("td",{className:"px-3 py-2",children:new Date(t.created_at).toLocaleString()}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["₹ ",n(t.amount)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["₹ ",n(t.net_amount??t.amount-t.charge)]}),e.jsx("td",{className:"px-3 py-2",children:t.method}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:t.status==="paid"?"text-green-600":t.status==="rejected"?"text-red-600":t.status==="approved"?"text-blue-600":"text-yellow-600",children:t.status})}),e.jsx("td",{className:"px-3 py-2",children:t.txn_ref||"—"})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-3 py-6 text-center text-gray-500",children:"No withdrawals yet."})})})]})})]})]})]})}export{W as default};
