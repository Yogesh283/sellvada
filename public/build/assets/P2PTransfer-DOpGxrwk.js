import{r as o,c as A,j as e,H as S}from"./app-CZPWzBE5.js";import{A as F}from"./AuthenticatedLayout-CENbNRqm.js";function C({initialBalance:l=null,csrf:f,debug:T={}}){const[t,c]=o.useState({recipient:"",amount:"",remark:""}),[u,p]=o.useState({}),[g,j]=o.useState(!1),v=l!=null,[y,b]=o.useState(Number(v?l:0)),[x,k]=o.useState({open:!1,type:"info",message:""}),h=o.useRef(null);o.useEffect(()=>{console.log("P2P page props:",{initialBalance:l,csrf:f,debug:T}),v?b(Number(l??0)):w()},[]);const i=(s,n,r=4e3)=>{h.current&&clearTimeout(h.current),k({open:!0,type:s,message:n}),h.current=setTimeout(()=>k(a=>({...a,open:!1})),r)},w=async()=>{try{const s=await A.get("/p2p/balance",{headers:{"X-CSRF-TOKEN":f,Accept:"application/json"}});s?.data?.balance!==void 0&&(b(Number(s.data.balance)),console.log("Fetched balance via API:",s.data.balance))}catch(s){console.error("Failed to fetch balance:",s),i("error","Failed to load balance. Refresh page.")}},P=async s=>{s.preventDefault();const n=t.amount!==""?Number(String(t.amount).replace(/,/g,"")):t.amount,r={};if(t.recipient||(r.recipient="Recipient is required."),n===""||n===null||isNaN(n)?r.amount="Amount is required.":Number(n)<=0?r.amount="Enter a valid amount.":Number(n)>y&&(r.amount="Insufficient balance."),p(r),Object.keys(r).length){i("error",Object.values(r)[0]);return}j(!0);try{const a={...t,amount:Number(Number(n).toFixed(2))},d=await A.post("/p2p/transfer",a,{headers:{"X-CSRF-TOKEN":f,Accept:"application/json"}});d?.data?.balance!==void 0?b(Number(d.data.balance)):await w(),c({recipient:"",amount:"",remark:""}),p({}),i("success",d.data.message||"Transfer successful.")}catch(a){if(console.error("Transfer error:",a),a.response&&a.response.data){const d=a.response.data.message||"Transfer failed.";if(i("error",d),a.response.data.errors){const N={};for(const m in a.response.data.errors)Array.isArray(a.response.data.errors[m])?N[m]=a.response.data.errors[m][0]:N[m]=a.response.data.errors[m];p(N)}}else i("error","Network error.")}finally{j(!1)}};return e.jsxs(F,{children:[e.jsx(S,{title:"P2P Transfer"}),e.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"P2P Transfer"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Available Balance"}),e.jsx("div",{className:"text-3xl font-semibold",children:Number(y||0).toFixed(2)})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Recipient (login id / username / email)"}),e.jsx("input",{value:t.recipient,onChange:s=>c({...t,recipient:s.target.value}),className:"mt-1 block w-full border rounded p-2",placeholder:"Enter recipient login id"}),u.recipient&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.recipient})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Amount"}),e.jsx("input",{value:t.amount,onChange:s=>c({...t,amount:s.target.value}),className:"mt-1 block w-full border rounded p-2",placeholder:"0.00",inputMode:"decimal"}),u.amount&&e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u.amount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Remark (optional)"}),e.jsx("input",{value:t.remark,onChange:s=>c({...t,remark:s.target.value}),className:"mt-1 block w-full border rounded p-2",placeholder:"For what purpose"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded disabled:opacity-60",disabled:g,children:g?"Processing...":"Send"}),e.jsx("button",{type:"button",className:"px-4 py-2 border rounded",onClick:()=>{c({recipient:"",amount:"",remark:""}),p({})},children:"Reset"})]})]})]}),x.open&&e.jsx("div",{className:"fixed bottom-5 right-5 z-50",children:e.jsx("div",{className:`px-4 py-3 rounded shadow text-white ${x.type==="success"?"bg-green-600":"bg-red-600"}`,children:x.message})})]})}export{C as default};
