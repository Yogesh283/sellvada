import{b as I,r as o,j as e,H as F,a as T}from"./app-BHnpG12W.js";import{A as _}from"./AuthenticatedLayout-agL2eqlU.js";const a=l=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(Number(l||0));function $({open:l,title:d,message:u,tone:c="neutral",onClose:r}){if(!l)return null;const i=c==="success"?"ring-emerald-400":c==="error"?"ring-rose-400":"ring-cyan-400";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:`w-full max-w-md rounded-2xl bg-white shadow-xl ring ${i} ring-1`,children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:d}),e.jsx("button",{onClick:r,className:"rounded-md p-1 text-slate-500 hover:bg-slate-100",children:"✕"})]}),e.jsx("div",{className:"p-4 text-slate-700 whitespace-pre-line",children:u}),e.jsx("div",{className:"flex justify-end border-t border-slate-200 p-3",children:e.jsx("button",{onClick:r,className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700",children:"Close"})})]})})}function D({it:l,onInc:d,onDec:u,onRemove:c}){const r=Number(l.price)*Number(l.qty);return e.jsxs("div",{className:"grid grid-cols-1 gap-3 py-3 border-b border-slate-100 sm:grid-cols-[88px_1fr_120px_92px_120px_64px] sm:items-center",children:[e.jsx("div",{className:"h-20 w-20 overflow-hidden rounded-md bg-slate-100",children:e.jsx("img",{src:l.img,alt:l.name,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:l.name}),l.variant&&e.jsx("div",{className:"text-xs text-slate-500",children:l.variant})]}),e.jsx("div",{className:"text-sm font-medium text-slate-700",children:a(l.price)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:u,className:"h-7 w-7 rounded-md border bg-white hover:bg-slate-50",type:"button",children:"−"}),e.jsx("input",{readOnly:!0,value:l.qty,className:"h-7 w-10 rounded-md border text-center text-sm"}),e.jsx("button",{onClick:d,className:"h-7 w-7 rounded-md border bg-white hover:bg-slate-50",type:"button",children:"＋"})]}),e.jsx("div",{className:"text-right font-semibold",children:a(r)}),e.jsx("div",{children:e.jsx("button",{onClick:c,className:"text-xs text-rose-600 hover:text-rose-700",children:"Remove"})})]})}function M({product:l,walletBalance:d=0,defaultAddress:u=null}){const{auth:c}=I().props??{},[r,i]=o.useState([]),q=s=>i(t=>t.find(x=>x.id===s.id)?t.map(x=>x.id===s.id?{...x,qty:x.qty+1}:x):[...t,{id:s.id,name:s.name,img:s.img,variant:s.variant||null,price:Number(s.price),qty:1,type:"repurchase"}]),S=s=>i(t=>t.map(n=>n.id===s?{...n,qty:n.qty+1}:n)),R=s=>i(t=>t.map(n=>n.id===s&&n.qty>1?{...n,qty:n.qty-1}:n)),A=s=>i(t=>t.filter(n=>n.id!==s)),[v,y]=o.useState(""),[h,f]=o.useState(null),P=s=>{s?.preventDefault?.();const t=(v||"").trim().toUpperCase();if(!t){f(null);return}f(t==="FLAT10"?t:null)},j=o.useMemo(()=>r.reduce((s,t)=>s+Number(t.price)*Number(t.qty),0),[r]),w=o.useMemo(()=>h==="FLAT10"?Math.round(j*.1):0,[h,j]),p=Math.max(0,j-w),[m,C]=o.useState(!1),[b,k]=o.useState({show:!1,title:"",message:"",tone:"neutral"}),g=(s,t,n="success")=>k({show:!0,title:s,message:t,tone:n}),N=()=>{if(!r.length)return g("Cart Empty","Please add items to cart.","error");if(!u)return g("No Address","Please add a shipping address.","error");if(d<Number(p))return g("Insufficient Balance",`Need ${a(p)} in wallet.`,"error");T.post(route("repurchase.checkout"),{items:r,coupon:h},{preserveScroll:!0,onStart:()=>C(!0),onFinish:()=>C(!1),onSuccess:()=>{const s=r.map(t=>`${t.name} x ${t.qty} = ${a(t.price*t.qty)}`).join(`
`);i([]),f(null),y(""),g("Order Success",`Repurchase order placed!

${s}

Total: ${a(p)}`,"success")},onError:()=>g("Checkout Failed","Something went wrong.","error")})};return e.jsxs(_,{user:c?.user,children:[e.jsx(F,{title:"Repurchase"}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-6 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold tracking-tight",children:"Repurchase"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["Wallet:"," ",e.jsx("span",{className:"font-semibold text-slate-900",children:a(d)})]})]}),e.jsx("section",{className:"rounded-2xl bg-white p-4 sm:p-6 shadow ring-1 ring-slate-100",children:e.jsxs("div",{className:"grid md:grid-cols-[360px_1fr] gap-6 items-start",children:[e.jsx("img",{src:l.img,alt:l.name,className:"w-[320px] h-[320px] object-cover rounded-2xl bg-slate-50"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:l.name}),e.jsx("div",{className:"text-2xl font-semibold",children:a(l.price)}),e.jsxs("div",{className:"mt-4 flex w-full flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>q(l),className:"w-full sm:w-auto rounded-lg border border-indigo-600 px-4 py-2.5 text-sm font-semibold text-indigo-700 hover:bg-indigo-50",type:"button",children:"Add to Cart"}),e.jsx("button",{onClick:N,disabled:m,className:"w-full sm:w-auto rounded-lg bg-gradient-to-r from-indigo-600 to-blue-600 px-4 py-2.5 text-sm font-semibold text-white hover:from-indigo-700 hover:to-blue-700 disabled:opacity-60",type:"button",children:m?"Processing...":"Buy Now"})]})]})]})}),r.length>0&&e.jsxs("section",{className:"rounded-2xl bg-white p-4 sm:p-6 shadow ring-1 ring-slate-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Cart"}),e.jsx("div",{className:"divide-y divide-slate-100",children:r.map(s=>e.jsx(D,{it:s,onInc:()=>S(s.id),onDec:()=>R(s.id),onRemove:()=>A(s.id)},s.id))}),e.jsxs("form",{onSubmit:P,className:"mt-4 flex items-center gap-2",children:[e.jsx("input",{value:v,onChange:s=>y(s.target.value),placeholder:"Have a coupon? e.g., FLAT10",className:"flex-1 rounded-lg border border-slate-300 px-3 py-2 text-sm"}),e.jsx("button",{type:"submit",className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700",children:"Apply"}),h&&e.jsxs("span",{className:"text-xs font-medium text-emerald-700",children:["Applied: ",h]})]}),e.jsxs("div",{className:"mt-4 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:a(j)})]}),e.jsxs("div",{className:"flex justify-between text-emerald-700",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["- ",a(w)]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:a(p)})]})]}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:N,disabled:m,className:"flex-1 rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700 disabled:opacity-60",children:m?"Processing...":"Proceed to Checkout"})})]}),r.length>0&&e.jsx("div",{className:"lg:hidden sticky bottom-0 inset-x-0 border-t border-slate-200 bg-white/95 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-2 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"text-slate-600",children:"Total"}),e.jsx("div",{className:"font-semibold text-slate-900",children:a(p)})]}),e.jsx("button",{onClick:N,disabled:m,className:"inline-flex flex-1 justify-center rounded-lg bg-indigo-600 px-4 py-2 text-white font-semibold hover:bg-indigo-700 disabled:opacity-60",type:"button",children:m?"…":"Checkout"})]})})]}),e.jsx($,{open:b.show,title:b.title,message:b.message,tone:b.tone,onClose:()=>k({...b,show:!1})})]})}export{M as default};
